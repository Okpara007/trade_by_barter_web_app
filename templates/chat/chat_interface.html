{% extends 'base.html' %}
{% load static %}

{% block content %}
<style>
  /* Optional: Style the chat container */
  #talkjs-container {
    width: 100%;
    height: 500px;
    margin-top: 2rem;
  }
</style>

<div id="talkjs-container">
  <i>Loading chat...</i>
</div>

<script>
  // Ensure TalkJS is loaded before initializing
  if (typeof Talk === 'undefined') {
    console.error('TalkJS library is not loaded');
  } else {
    Talk.ready.then(function() {
      // Define the current user
      var me = new Talk.User({
        id: "{{ request.user.id }}",
        name: "{{ request.user.username }}",
        email: "{{ request.user.email }}"
      });
      // Define the other user
      var other = new Talk.User({
        id: "{{ other_user.id }}",
        name: "{{ other_user.username }}",
        email: "{{ other_user.email }}"
      });
      // Initialize the session with the app ID
      window.talkSession = new Talk.Session({
        appId: "tw6C1KHF",
        me: me
      });
      // Create or get a conversation
      var conversation = talkSession.getOrCreateConversation(Talk.oneOnOneId(me, other));
      conversation.setParticipant(me);
      conversation.setParticipant(other);
      // Mount the chatbox
      var chatbox = talkSession.createChatbox(conversation);
      chatbox.mount(document.getElementById("talkjs-container"));
    }).catch(function(error) {
      console.error("TalkJS initialization failed:", error);
    });
  }
</script>
{% endblock %}